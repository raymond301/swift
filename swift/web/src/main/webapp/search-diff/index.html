<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/common/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <style type="text/css">
        #fileTable td.present {
            background-color: #ebffee;
        }
        #fileTable tr:hover td.present {
            background-color: #e3f6e6;
        }
        #fileTable thead tr th {
            width: 2em;
            height: 18em;
            overflow-y: hidden;
        }
        #fileTable thead tr th .filename {
            width: 0;
            height: 0;
            font-size: 12px;
            /* FF Chrome Opera etc */
            -webkit-transform: rotate(-90deg);
            -moz-transform: rotate(-90deg);
            -o-transform: rotate(-90deg);
            /* IE */
            filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=1);
        }
    </style>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="/common/bootstrap/js/html5shiv.js"></script>
    <![endif]-->

    <script type="text/javascript" src="/common/bootstrap/js/jquery_1.9.0.min.js"></script>
    <title>Search Difference</title>
    <script type="text/javascript">
        // Read a page's GET URL variables and return them as an associative array.
        function getUrlVars()
        {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for(var i = 0; i < hashes.length; i++)
            {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }

        // Convert the data, filling the #fileTable object
        function fillFileTable(data) {
            // Head row - list of all files
            head = $("#fileTable > thead");
            head.empty();
            head.append("<tr></tr>");
            headRow = $("#fileTable > thead > tr");
            headRow.append('<td></td>');

            $(data.diffs.inputFiles).each(function (index, file) {
                headRow.append('<th><div class="filename" title="'+file.name+'">' + file.name + '</div></th>');
            });

            // Body - for each search, protein group counts + extra
            body = $("#fileTable > tbody");
            body.innerHTML="";
            $(data.diffs.searches).each(function (searchIndex, search) {
                row = $("<tr></tr>");
                row.append('<th>' + search.title + '</th>');
                $(data.diffs.inputFiles).each(function (index, file) {
                    cell = data.diffs.results[file.id][search.id];
                    if (cell.present) {
                        row.append('<td style="text-align: center" class="present">' + cell.proteinGroups + '</td>');
                    } else {
                        row.append('<td></td>');
                    }
                });
                body.append(row);
            });
        }

        $(document).ready(function () {
            id = getUrlVars()['id'];
            $.get("/service/search-diffs.json",
                    {'id' : id},
                    function(data) {
                        fillFileTable(data);
                    },
                    "json" );
        });
    </script>
</head>
<body>
<div class="container">
    <h1>Search Comparison</h1>
<table id="fileTable" class="table table-bordered table-condensed table-hover">
    <thead><tr><td><img src="/start/images/ajax-loader.gif"/></td></tr></thead>
    <tbody></tbody>
    <tfoot></tfoot>
</table>
</div>
</body>
</html>